<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Events Accordion</title>

    <!-- Bootswatch Flatly -->
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.8/dist/flatly/bootstrap.min.css" rel="stylesheet">

</head>

<body class="p-4">

    <h1 class="mb-4">Liste des événements</h1>

    <!-- Conteneur Accordion -->
    <div class="accordion" id="eventsAccordion"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Connexion WebSocket à l'ESP32
        const ws = new WebSocket(`ws://${location.hostname}/ws`);

        ws.onmessage = (event) => {
            const events = JSON.parse(event.data);
            renderAccordion(events);
        };

        // Génération dynamique de l'accordion
        function renderAccordion(events) {
            const container = document.getElementById('eventsAccordion');
            container.innerHTML = ""; // Efface l’ancien contenu

            events.forEach((ev, index) => {
                const id = `event${index}`;

                const html = `
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading-${id}">
                        <button class="accordion-button collapsed"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#collapse-${id}"
                                aria-expanded="false"
                                aria-controls="collapse-${id}">
                            ${ev.time} – ${ev.name}
                        </button>
                    </h2>

                    <div id="collapse-${id}"
                         class="accordion-collapse collapse"
                         aria-labelledby="heading-${id}"
                         data-bs-parent="#eventsAccordion">
                        <div class="accordion-body">
                            <strong>Évènement :</strong> ${ev.name}<br>
                            <strong>Heure :</strong> ${ev.time}<br><br>

                            <!-- Exemple de contenu modifiable -->
                            <button class="btn btn-primary btn-sm" onclick="editEvent(${index})">
                                Modifier
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteEvent(${index})">
                                Supprimer
                            </button>
                        </div>
                    </div>
                </div>
                `;

                container.insertAdjacentHTML("beforeend", html);
            });
        }

        // Fonctions "fake" (à relier plus tard)
        function editEvent(i) {
            alert("Éditer l'évènement #" + i);
        }

        function deleteEvent(i) {
            alert("Supprimer l'évènement #" + i);
        }
    </script>

</body>
</html>

